---
layout: post
title: Rust first taste
date: 21-08-30 20:55:46 +0800
categories: rust
---

# Rust初探

## 1. 安装rust

在Unix-like系统下，通过下面的命令下载Rustup工具并安装rust：

```sh
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

在根目录下运行后出现：

```sh
$ curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
info: downloading installer

Welcome to Rust!

This will download and install the official compiler for the Rust
programming language, and its package manager, Cargo.

Rustup metadata and toolchains will be installed into the Rustup
home directory, located at:

  /home/bw/.rustup

This can be modified with the RUSTUP_HOME environment variable.

The Cargo home directory located at:

  /home/bw/.cargo

This can be modified with the CARGO_HOME environment variable.

The cargo, rustc, rustup and other commands will be added to
Cargo's bin directory, located at:

  /home/bw/.cargo/bin

This path will then be added to your PATH environment variable by
modifying the profile files located at:

  /home/bw/.profile
  /home/bw/.bashrc
  /home/bw/.zshenv

You can uninstall at any time with rustup self uninstall and
these changes will be reverted.

Current installation options:


   default host triple: x86_64-unknown-linux-gnu
     default toolchain: stable (default)
               profile: default
  modify PATH variable: yes

1) Proceed with installation (default)
2) Customize installation
3) Cancel installation
>
```

作为小白那就直接回车保持默认选项喽。

```sh
  stable-x86_64-unknown-linux-gnu installed - rustc 1.54.0 (a178d0322 2021-07-26)


Rust is installed now. Great!

To get started you may need to restart your current shell.
This would reload your PATH environment variable to include
Cargo's bin directory ($HOME/.cargo/bin).

To configure your current shell, run:
source $HOME/.cargo/env

```

下载了一堆东西后就显示安装成功了，重启一下终端刷新环境变量。或者`source $HOME/.cargo/env`也行。

由于rust更新频率很高，应该时常更新：

```sh
rustup update
```



### 1.1 Cargo: Rust编译、包管理工具

```sh
cargo build # 编译项目
cargo run	# 运行项目
cargo test	# 测试项目
cargo doc	# 编译项目文档
cargo publish	# 发布库到crates.io
```

运行下面的命令来测试rust和cargo是否已经安装：

```sh
$ cargo --version
cargo 1.54.0 (5ae8d74b3 2021-06-22)
```



## 2. 生成一个新项目

在项目目录下运行

```sh
cargo new hello-rust
```

目录下就产生一个hello-rust项目目录：

```
$ tree
.
└── hello-rust
    ├── Cargo.toml
    └── src
        └── main.rs
```

创建rust项目的同时也自动生成了git仓库：

```sh
$ la
./  ../  Cargo.toml  .git/  .gitignore  src/
```

暂且创建一个GitHub Repo来存储rust项目吧。

`Cargo.toml`是Rust的清单文件(manifest file)，保存了元数据(metadata)和依赖项。打开看看：

```toml
[package]
name = "hello-rust"
version = "0.1.0"
edition = "2018"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]

```

`main.rs`就是应用代码文件了，也打开看看：

```rust
fn main() {
    println!("Starplatinum, the World!"); // 稍微改一改
}
```

`Cargo new`创建了一个Helloworld程序。在项目目录`hello-rust`下运行

```sh
$ cargo run
   Compiling hello-rust v0.1.0 (/home/bw/Documents/CODE/study/rust_learning/hello-rust)
    Finished dev [unoptimized + debuginfo] target(s) in 0.99s
     Running `target/debug/hello-rust`
Starplatinum, the World!
```

前面是编译信息，最后一行就是输出了。可执行文件在`./target/debug`目录下面创建



## 3. 添加依赖

可以在[crates.io](https://crates.io/)查看各种库，在Rust中把库称为`crates`（木箱），不知道官方中文译作什么，说起来Cargo也是货物的意思，货物管理器，管理的是木箱，这恒河里。尝试添加一个叫做`ferris-says`的crate，类似于Linux的`cowsay`。

在Cargo.toml中添加：

```toml
[dependencies]
ferris-says = "0.2"
```

然后运行

```sh
cargo build
```

这下载有些太慢了

![]({{'/imgs/rust/1_first_taste/001_too_slow.png' | prepend: site.baseurl}})

根据[这一篇](https://zhuanlan.zhihu.com/p/126204128)配置一下`crates.io`的[tuna镜像](https://mirrors.tuna.tsinghua.edu.cn/help/crates.io-index.git/)。

再运行`cargo build`，快多了，很舒服。

```sh
$ cargo build
    Updating `https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git` index
  Downloaded unicode-width v0.1.8 (registry `https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git`)
  Downloaded ferris-says v0.2.1 (registry `https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git`)
  Downloaded smallvec v0.4.5 (registry `https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git`)
  Downloaded smawk v0.3.1 (registry `https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git`)
  Downloaded textwrap v0.13.4 (registry `https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git`)
  Downloaded 5 crates (97.7 KB) in 2.76s
   Compiling smawk v0.3.1
   Compiling unicode-width v0.1.8
   Compiling smallvec v0.4.5
   Compiling textwrap v0.13.4
   Compiling ferris-says v0.2.1
   Compiling hello-rust v0.1.0 (/home/bw/Documents/CODE/study/rust_learning/hello-rust)
    Finished dev [unoptimized + debuginfo] target(s) in 48.94s
```

这条命令运行以后创建了`Cargo.lock`文件，里面是项目依赖项的信息。

```toml
# This file is automatically @generated by Cargo.
# It is not intended for manual editing.
version = 3

[[package]]
name = "ferris-says"
version = "0.2.1"
source = "registry+https://github.com/rust-lang/crates.io-index"
checksum = "9515ec2dd9606ec230f6b2d1f25fd9e808a2f2af600143f7efe7e5865505b7aa"
dependencies = [
 "smallvec",
 "textwrap",
 "unicode-width",
]

[[package]]
name = "hello-rust"
version = "0.1.0"
dependencies = [
 "ferris-says",
]

[[package]]
name = "smallvec"
version = "0.4.5"
source = "registry+https://github.com/rust-lang/crates.io-index"
checksum = "f90c5e5fe535e48807ab94fc611d323935f39d4660c52b26b96446a7b33aef10"

[[package]]
name = "smawk"
version = "0.3.1"
source = "registry+https://github.com/rust-lang/crates.io-index"
checksum = "f67ad224767faa3c7d8b6d91985b78e70a1324408abcb1cfcc2be4c06bc06043"

[[package]]
name = "textwrap"
version = "0.13.4"
source = "registry+https://github.com/rust-lang/crates.io-index"
checksum = "cd05616119e612a8041ef58f2b578906cc2531a6069047ae092cfb86a325d835"
dependencies = [
 "smawk",
 "unicode-width",
]

[[package]]
name = "unicode-width"
version = "0.1.8"
source = "registry+https://github.com/rust-lang/crates.io-index"
checksum = "9337591893a19b88d8d87f2cec1e73fad5cdfd10e5a6f349f498ad6ea2ffb1e3"

```

打开之前的`main.rs`文件，可以通过下面的语句引入ferris-says包中的say函数：

```rust
use ferris_says::say;
```

按照示例编写一段程序：

```rust
use ferris_says::say; // from the previous step
use std::io::{stdout, BufWriter};

fn main() {
    let stdout = stdout();
    let message = String::from("Hello fellow Rustaceans!");
    let width = message.chars().count();

    let mut writer = BufWriter::new(stdout.lock());
    say(message.as_bytes(), width, &mut writer).unwrap();
}
```

保存，然后`cargo run`

```sh
$ cargo run
   Compiling hello-rust v0.1.0 (/home/bw/Documents/CODE/study/rust_learning/hello-rust)
    Finished dev [unoptimized + debuginfo] target(s) in 0.57s
     Running `target/debug/hello-rust`
 __________________________
< Hello fellow Rustaceans! >
 --------------------------
        \
         \
            _~^~^~_
        \) /  o o  \ (/
          '_   -   _'
          / '-----' \


```

这只小螃蟹叫做Ferris，是Rust社区的吉祥物。

Rust程序员一般称自己为`Rustaceans`

至此Rust初探就完成了，可以在[官方网站](https://www.rust-lang.org/learn)进一步学习！

